<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ê³ êµ°ë¶„íˆ¬ - Flash Launcher</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Ruffle: Flash ì—ë®¬ë ˆì´í„° (CDN) -->
  <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  <link rel="stylesheet" href="styles.css" />

  <!-- favicon ì„¤ì • (16x16 PNG) -->
  <link rel="icon" href="favicon.png" type="image/png" sizes="16x16" />

  <meta name="color-scheme" content="dark light">
</head>
<body>
  <header class="site-header">
    <h1>ê³ êµ°ë¶„íˆ¬</h1>
    <p class="subtitle">Flash ì—ë®¬ë ˆì´í„°(Ruffle)ë¡œ ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ í”Œë ˆì´</p>
  </header>

  <main class="container">
    <section class="player-card">
      <div class="player-toolbar">
        <button id="btnReload" class="btn" title="ë‹¤ì‹œ ë¡œë“œ">ğŸ”„ ë‹¤ì‹œ ë¡œë“œ</button>
        <button id="btnFullscreen" class="btn" title="ì „ì²´í™”ë©´ ì „í™˜">â›¶ ì „ì²´í™”ë©´</button>
        <label class="file-label">
          ğŸ’¾ SWF íŒŒì¼ ì—´ê¸°
          <input id="fileInput" type="file" accept=".swf" />
        </label>
      </div>

      <div id="stage" class="stage" aria-label="ê²Œì„ ë¬´ëŒ€"></div>

      <p class="hint">
        ê¸°ë³¸ìœ¼ë¡œ <code>assets/ê³ êµ°ë¶„íˆ¬.swf</code>ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.<br/>
        ë‹¤ë¥¸ SWFë¥¼ ì‹œí—˜í•´ë³´ê³  ì‹¶ìœ¼ë©´ ìœ„ì˜ <b>SWF íŒŒì¼ ì—´ê¸°</b> ë²„íŠ¼ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ë¬´ëŒ€ì— <b>ë“œë˜ê·¸&ë“œë¡­</b>í•˜ì„¸ìš”.
      </p>
    </section>

    <section class="faq">
      <details>
        <summary>ì‹¤í–‰ ì•ˆ ë  ë•Œ ì²´í¬ë¦¬ìŠ¤íŠ¸</summary>
        <ul>
          <li><b>íŒŒì¼ ê²½ë¡œ</b>: <code>assets/ê³ êµ°ë¶„íˆ¬.swf</code> ê°€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸</li>
          <li><b>ì •ì  ì„œë²„</b>: ì¼ë¶€ ë¸Œë¼ìš°ì €ëŠ” <code>file://</code> ë¡œë“œ ì‹œ WASM/SWF ì ‘ê·¼ì„ ì œí•œí•©ë‹ˆë‹¤.<br/>
            ê°€ëŠ¥í•œ ê²½ìš° ê°„ë‹¨í•œ ì •ì  ì„œë²„(ì˜ˆ: VSCode Live Server, <code>python -m http.server</code>)ë¡œ ì—´ì–´ì£¼ì„¸ìš”.</li>
          <li><b>ìƒˆë¡œê³ ì¹¨</b>: ìºì‹œ ë¬¸ì œì¼ ìˆ˜ ìˆì–´ Ctrl+F5(ê°•ë ¥ ìƒˆë¡œê³ ì¹¨) ì‹œë„</li>
        </ul>
      </details>
    </section>
  </main>

  <footer class="site-footer">
    <small>Â© 2025 Flash Game Launcher Â· Ruffle ê¸°ë°˜</small>
  </footer>

  <script>
    const stage = document.getElementById('stage');
    const fileInput = document.getElementById('fileInput');
    const btnReload = document.getElementById('btnReload');
    const btnFullscreen = document.getElementById('btnFullscreen');

    let rufflePlayer;
    // ê¸°ë³¸ ë¡œë“œ ê²½ë¡œë¥¼ ê³ êµ°ë¶„íˆ¬ë¡œ ë³€ê²½
    let currentSrc = "assets/ê³ êµ°ë¶„íˆ¬.swf";

    function createPlayer() {
      stage.innerHTML = "";
      const ruffle = window.RufflePlayer?.newest();
      rufflePlayer = ruffle.createPlayer();
      rufflePlayer.classList.add("ruffle-player");
      stage.appendChild(rufflePlayer);
      rufflePlayer.style.width = "100%";
      rufflePlayer.style.height = "100%";
      rufflePlayer.load(currentSrc).catch(err => {
        console.error("SWF ë¡œë“œ ì‹¤íŒ¨:", err);
        stage.innerHTML = `
          <div class="error">
            <p>SWF ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
            <p class="mono">${escapeHtml(String(err))}</p>
            <p>ê²½ë¡œì™€ ì„œë²„ êµ¬ë™ ì—¬ë¶€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
          </div>`;
      });
    }

    function escapeHtml(s) {
      return s.replaceAll("&", "&amp;")
              .replaceAll("<", "&lt;")
              .replaceAll(">", "&gt;")
              .replaceAll('"', "&quot;")
              .replaceAll("'", "&#039;");
    }

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      currentSrc = url;
      createPlayer();
    });

    stage.addEventListener('dragover', (e) => {
      e.preventDefault();
      stage.classList.add('dragover');
    });
    stage.addEventListener('dragleave', () => stage.classList.remove('dragover'));
    stage.addEventListener('drop', (e) => {
      e.preventDefault();
      stage.classList.remove('dragover');
      const file = e.dataTransfer?.files?.[0];
      if (file && file.name.toLowerCase().endsWith('.swf')) {
        const url = URL.createObjectURL(file);
        currentSrc = url;
        createPlayer();
      }
    });

    btnReload.addEventListener('click', () => createPlayer());
    btnFullscreen.addEventListener('click', () => {
      if (!rufflePlayer) return;
      if (rufflePlayer.requestFullscreen) {
        rufflePlayer.requestFullscreen();
      } else if (stage.requestFullscreen) {
        stage.requestFullscreen();
      }
    });

    document.addEventListener('DOMContentLoaded', createPlayer);
  </script>
</body>
</html>
